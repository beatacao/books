# Web 组件分离  

    本章web 组件指： 所有web服务器提供的基于url访问的资源。   
    组件分离的目的： 便于采用针对性方法，使得各种web组件充分利用服务器资源，达到符合各自实际情况的吞吐率最大化。  

## 9.2 因材施教  

> web 组件特点   

    . 文件大小  
    . 文件数量  
    . 内容更新频率  
    . 预计并发用户数  
    . 是否需要脚本解释   
    . 是否涉及大量cpu计算  
    . 是否需要访问数据库   
    . 访问数据的操作是读还是写   
    . 是否需要远程调用（RPC）     

> 优化措施  

    . 是否使用epoll模型   
    . 是否使用 sendfile() 系统调用   
    . 是否使用异步  I/O   
    . 是否需要http持久连接   
    . 是否需要 opcode 缓存   
    . 是否需要动态内容缓存、web服务器缓存、反向代理缓存、浏览器缓存
    . 如果需要缓存，缓存有效期多久  
    . 是否需要均衡负载    

## 9.3 使用不同域名   

    为各类web组件使用不同域名（不同物理服务器或同一物理服务器的不同逻辑单元）。   
    子级域名： cookie问题   

    web组件分离的挑战：如何自动将组件迁移到对象的服务器上，而用户并不感到延迟。（如：用户上传照片时，自动将照片迁移到照片服务器，并且用户并不感到延迟，尤其是大量用户同时上传时）    

## 9.4 浏览器并发数    

    web组件分离，使用不同域名，提高了web组件在浏览器的并发数。因为浏览器对资源下载并发数的限制是针对单一域名。   

## 9.5 发挥各自的潜力   

    针对不同类型资源的优化建议。   

### 动态内容   

    . 开启opcode缓存、足够cpu、足够内存、多进程、与数据库保持告诉连接、可靠的数据中心，不同服务不同域名等等   

### 静态内容   

    不需要动态脚本解释器的参与，节省了cpu 和 内存开销，全身心头部 I/O 操作，属于 I/O密集型。   
    静态内容吞吐率很大程度上，取决于服务器的并发能力。   

> 优化建议   

    . 支持 epoll: 使得web服务器在较大用户并发数的情况下，保持较稳定的吞吐率    
    . 非阻塞IO，异步IO: 避免不必要的IO等待    
    . 使用 sendfile 系统调用： 避免文件系统磁盘缓冲区到用户地址空间的数据复制    
    . 单进程： 避免进程切换开销。对于 IO密集型操作，多进程并不能带来多大意义。   
    . 使用高速磁盘：磁盘转速是磁盘吞吐率的一个重要因素。   
    . 使用 RAID 分区： 使得磁盘可以实现并行读写，提高磁盘的吞吐率。   
    . 购买足够的带宽：对于静态资源来说，服务器主要是输出内容。   
    . 充分利用浏览器缓存   
    . 持久连接  - 例： 一个网页中包含很多图片   


 


