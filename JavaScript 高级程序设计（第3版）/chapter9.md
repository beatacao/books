# 客户端检测  
     
     web客户端检测的手段很多，各有利弊。不到万不得已，不要使用客户端检测。应该先找到最通用的方案，然后再使用特定于浏览器的增强方案。  

## 9.1 能力检测  

    能力检测不关心是否为某一特定浏览器，只关心是否有特定的功能。  
    关于能力检测的两个重要概念：  
    1、先检测可以达成目的的最常用的特性，这可以保证代码最优化，因为在多数情况下可以避免检测多个条件  
    2、必须测试实际要用到的特性，因为一个特定存在，并不代表另一个特定也存在（最好不要通过某一特定来判断是某种浏览器，从而用该浏览器的另一种特性）  

> 不要通过能力检测来判断是否为某一浏览器: 浏览器一直在发展，特定也在改变。   

## 9.2 怪癖检测  

    目标是识别浏览器的特殊行为，通过运行一段代码来检测浏览器是否存在某种缺陷。    

## 9.3 用户代理检测  

    在客户端检测中，用户代理检测（navigator.userAgent）被放在能力检测和怪癖检测之后，因为可能有‘电子欺骗’。  
    ‘电子欺骗’的来龙去脉，必须从web发展初期用户代理字符串的发展历史说起。  

### 9.3.1 用户代理字符串的历史  
 
    . HTTP规范明确规定，浏览器发送简短的用户代理字符串，指名浏览器的名称和版本号。  
    . 20世纪90年代（1996年左右），由于当时Netscape 浏览器占领绝对市场份额，许多服务器在提供服务之前都要专门检测该浏览器。当时微软发布了IE3.0，如果通过IE打不开网页，这个新生的浏览器很可能夭折，于是微软决定将IE的用户代理字符串修改成兼容Netscape形式，结果如下：  
    Mozilla/2.0 (compatible; MSIE 版本号； 操作系统)   这一做法非常不规范  
    . IE8 开始，在用户代理字符串中添加了呈现引擎Trident 版本号，可以通过此判断浏览器是不是在兼容模式下运行。   
    . 但IE用户代理字符串中一直保持兼容Netscape的形式，这是为了确保过去的用户代理检测脚本能够继续发挥作用，同时还能给新脚本提供更丰富的信息。     

### 9.3.2 用户代理字符串检测技术   

    通过了解代理字符串的发展历史得知，为了兼容服务器对浏览器的嗅探，各个浏览器厂商并没有严格遵守用户代理字符串的定义规范（名称/版本号），所以通过用户代理字符串（navigator.userAgent）来检测具体浏览器并不是一件容易的事情。  
    因此，在实际开发中，往往要确定的是需要多么具体的浏览器信息。一般情况下，知道呈现引擎和最低限度的版本就可进行正确操作了。  
    用户代理检测可以从几个方面：呈现引擎，js引擎，浏览器，版本，平台，操作系统等方面进行。  

### 9.3.4 各种检测使用方法  

    特性检测和怪癖检测优先，最后万不得已采用用户代理检测，比如以下情况：  
    1、特性检测和怪癖检测不能准确进行，比如有些浏览器为将来功能预留的存根（stub）函数，这时并不能通过简单检测该函数是否存在来满足需要。 
    2、浏览器在不同平台下某些特性表现不同，需要检测平台进行特殊处理。  
    3、为了跟踪分析等目的需要知道确切浏览器。  